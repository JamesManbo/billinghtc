CREATE PROCEDURE `GetOpeningDebts`(IN `voucherIds` mediumtext)BEGIN	DROP TEMPORARY TABLE IF EXISTS T2;	CREATE TEMPORARY TABLE T2( TXT TEXT );	INSERT INTO T2 VALUES(voucherIds);	DROP TEMPORARY TABLE IF EXISTS VCHR_IDS_TEMP_2;	CREATE TEMPORARY TABLE VCHR_IDS_TEMP_2( VAL INT );	SET @insertToTempSql = CONCAT("INSERT INTO VCHR_IDS_TEMP_2 (VAL) VALUES ('", REPLACE(( SELECT GROUP_CONCAT(DISTINCT TXT) AS DATA FROM T2), ",", "'),('"),"');");	PREPARE STMT2 FROM @insertToTempSql;	EXECUTE STMT2;	DROP TEMPORARY TABLE IF EXISTS T2;		DROP TEMPORARY TABLE IF EXISTS VCHR_CONTRACT_TEMP;	CREATE TEMPORARY TABLE VCHR_CONTRACT_TEMP (VoucherId INT, ContractId INT, StartBillingDate DATE);		INSERT INTO VCHR_CONTRACT_TEMP	SELECT		t1.Id AS VoucherId,		t1.OutContractId,		MIN(t2.StartBillingDate) AS StartBillingDate	FROM ReceiptVouchers AS t1	INNER JOIN VCHR_IDS_TEMP_2 AS tmp ON tmp.VAL = t1.Id	INNER JOIN ReceiptVoucherDetails t2 ON t1.Id = t2.ReceiptVoucherId	WHERE t1.IsDeleted = FALSE AND t2.IsDeleted = FALSE	GROUP BY t1.Id, t1.OutContractId;		SELECT		tmp.VoucherId AS ReceiptVoucherId,		t2.ServiceId AS ServiceId,		t2.ServiceName AS  ServiceName,		SUM(t2.GrandTotal) AS  DebtAmount	FROM ReceiptVouchers AS t1	INNER JOIN VCHR_CONTRACT_TEMP AS tmp ON tmp.ContractId = t1.OutContractId	INNER JOIN ReceiptVoucherDetails t2 ON t1.Id = t2.ReceiptVoucherId	WHERE		t2.IsDeleted = FALSE AND		t1.Id <> tmp.VoucherId AND		(			YEAR(t2.StartBillingDate) < YEAR(tmp.StartBillingDate) OR			(YEAR(t2.StartBillingDate) = YEAR(tmp.StartBillingDate) AND MONTH(t2.StartBillingDate) < MONTH(tmp.StartBillingDate))		)	GROUP BY t2.ServiceId;END